<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Portfolio Â· Dec 2027</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:       #0d0f14;
    --surface:  #13161e;
    --surface2: #1a1e28;
    --border:   #252933;
    --accent:   #00e5a0;
    --accent2:  #3d8bff;
    --warn:     #ff6b6b;
    --gold:     #f5c842;
    --text:     #e8eaf0;
    --muted:    #6b7385;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg); color: var(--text);
    font-family: 'DM Sans', sans-serif; min-height: 100vh;
  }
  body::before {
    content: ''; position: fixed; top: -200px; left: -200px;
    width: 700px; height: 700px;
    background: radial-gradient(circle, rgba(0,229,160,0.07) 0%, transparent 70%);
    pointer-events: none; z-index: 0;
  }
  body::after {
    content: ''; position: fixed; bottom: -200px; right: -200px;
    width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(61,139,255,0.05) 0%, transparent 70%);
    pointer-events: none; z-index: 0;
  }

  .wrap { max-width: 920px; margin: 0 auto; padding: 32px 18px; position: relative; z-index: 1; }

  /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .hdr { margin-bottom: 28px; }
  .hdr-top { display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 12px; }
  .hdr h1 { font-family: 'DM Serif Display', serif; font-size: 2rem; line-height: 1.15; }
  .hdr h1 span { color: var(--accent); }
  .hdr p { font-size: 0.82rem; color: var(--muted); margin-top: 4px; }

  .live-btn {
    display: flex; align-items: center; gap: 7px;
    background: rgba(0,229,160,0.08); border: 1px solid rgba(0,229,160,0.22);
    padding: 8px 14px; border-radius: 999px;
    font-family: 'DM Mono', monospace; font-size: 0.73rem; color: var(--accent);
    cursor: pointer; transition: background 0.2s; white-space: nowrap;
  }
  .live-btn:hover { background: rgba(0,229,160,0.16); }
  .dot { width: 7px; height: 7px; border-radius: 50%; background: var(--accent); animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.25} }

  .goal-bar {
    margin-top: 14px; background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; padding: 14px 20px;
    display: flex; gap: 24px; flex-wrap: wrap; align-items: center;
  }
  .goal-item .gl { font-size: 0.68rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.07em; }
  .goal-item .gv { font-family: 'DM Mono', monospace; font-size: 0.92rem; margin-top: 3px; }
  .goal-item .gv.gold  { color: var(--gold); }
  .goal-item .gv.blue  { color: var(--accent2); }
  .goal-item .gv.green { color: var(--accent); }

  /* â”€â”€ KPI Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 28px; }
  .card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 14px; padding: 18px 16px;
    transition: border-color 0.2s, transform 0.2s;
    animation: fadeUp 0.5s ease both;
  }
  .card:hover { border-color: rgba(0,229,160,0.28); transform: translateY(-2px); }
  @keyframes fadeUp { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }
  .card:nth-child(1){animation-delay:0.05s} .card:nth-child(2){animation-delay:0.1s}
  .card:nth-child(3){animation-delay:0.15s} .card:nth-child(4){animation-delay:0.2s}
  .card .cl { font-size: 0.68rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 7px; }
  .card .cv { font-family: 'DM Mono', monospace; font-size: 1.25rem; font-weight: 500; }
  .card .cs { font-size: 0.73rem; color: var(--muted); margin-top: 3px; }
  .g { color: var(--accent); } .r { color: var(--warn); } .b { color: var(--accent2); } .go { color: var(--gold); }

  /* â”€â”€ Section label â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sec {
    font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted);
    margin-bottom: 12px; display: flex; align-items: center; gap: 10px;
  }
  .sec::after { content: ''; flex: 1; height: 1px; background: var(--border); }

  /* â”€â”€ Fund cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .fund {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 14px; padding: 20px; margin-bottom: 12px;
    transition: border-color 0.2s, transform 0.2s;
    animation: fadeUp 0.5s ease both;
  }
  .fund:hover { border-color: rgba(61,139,255,0.28); transform: translateY(-1px); }
  .fund:nth-child(1){animation-delay:0.1s} .fund:nth-child(2){animation-delay:0.18s} .fund:nth-child(3){animation-delay:0.26s}

  .fund-top { display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 12px; }
  .fund-left { display: flex; gap: 14px; }
  .ficon {
    width: 42px; height: 42px; border-radius: 10px; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    font-family: 'DM Mono', monospace; font-size: 0.68rem; font-weight: 500; color: #fff;
  }
  .fname { font-weight: 500; font-size: 0.9rem; line-height: 1.35; }
  .ftype { font-size: 0.7rem; color: var(--muted); margin-top: 3px; }
  .sip-tag {
    background: rgba(61,139,255,0.1); border: 1px solid rgba(61,139,255,0.18);
    color: var(--accent2); font-size: 0.67rem; font-family: 'DM Mono', monospace;
    padding: 2px 8px; border-radius: 999px; margin-top: 5px; display: inline-block;
  }

  .nav-badge {
    font-family: 'DM Mono', monospace; font-size: 0.8rem;
    background: rgba(0,229,160,0.07); border: 1px solid rgba(0,229,160,0.15);
    padding: 5px 11px; border-radius: 8px; color: var(--accent);
    white-space: nowrap; min-width: 180px; text-align: center;
  }
  .nav-badge.loading { opacity: 0.45; animation: blink 1.2s infinite; }
  .nav-badge.error   { color: var(--warn); border-color: rgba(255,107,107,0.2); background: rgba(255,107,107,0.05); }
  @keyframes blink { 0%,100%{opacity:0.45} 50%{opacity:0.15} }

  .fnums { display: flex; gap: 20px; flex-wrap: wrap; margin-top: 16px; padding-top: 14px; border-top: 1px solid var(--border); }
  .ni .nl { font-size: 0.63rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.06em; }
  .ni .nv { font-family: 'DM Mono', monospace; font-size: 0.9rem; margin-top: 3px; }

  .bar-track { background: var(--surface2); border-radius: 999px; height: 4px; margin-top: 14px; overflow: hidden; }
  .bar-fill  { height: 100%; border-radius: 999px; }

  /* â”€â”€ Status bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .status {
    text-align: center; font-family: 'DM Mono', monospace;
    font-size: 0.72rem; color: var(--muted); margin: -4px 0 20px; padding: 10px;
  }
  .status.ok    { color: var(--accent); }
  .status.err   { color: var(--warn); }
  .status.info  { color: var(--accent2); }

  .refresh-btn {
    display: block; margin: 0 auto 28px;
    background: rgba(0,229,160,0.08); border: 1px solid rgba(0,229,160,0.22);
    color: var(--accent); font-family: 'DM Mono', monospace; font-size: 0.75rem;
    padding: 9px 20px; border-radius: 9px; cursor: pointer; transition: background 0.2s;
  }
  .refresh-btn:hover { background: rgba(0,229,160,0.18); }

  /* â”€â”€ Projection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .proj-box {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 14px; padding: 24px; margin-bottom: 28px;
  }
  .proj-box h3 { font-family: 'DM Serif Display', serif; font-size: 1.1rem; margin-bottom: 18px; }
  .slider-row { display: flex; align-items: center; gap: 14px; margin-bottom: 20px; flex-wrap: wrap; }
  .slider-row label { font-size: 0.78rem; color: var(--muted); }
  input[type=range] {
    -webkit-appearance: none; width: 150px; height: 4px;
    border-radius: 2px; background: var(--border); outline: none; cursor: pointer;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none; width: 16px; height: 16px; border-radius: 50%;
    background: var(--accent); cursor: pointer; box-shadow: 0 0 8px rgba(0,229,160,0.45);
  }
  #rate-val { font-family: 'DM Mono', monospace; color: var(--accent); font-size: 0.9rem; min-width: 38px; }

  .proj-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr)); gap: 10px; }
  .pi {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 10px; padding: 14px; text-align: center;
  }
  .pi.hi {
    background: linear-gradient(135deg, rgba(0,229,160,0.12), rgba(61,139,255,0.12));
    border-color: rgba(0,229,160,0.28);
  }
  .pi .pl { font-size: 0.65rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 6px; }
  .pi .pv { font-family: 'DM Mono', monospace; font-size: 1rem; }
  .pi.hi .pv { color: var(--accent); font-size: 1.2rem; }

  .prog-wrap { margin-top: 18px; }
  .prog-labels { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--muted); margin-bottom: 6px; }
  .prog-track  { background: var(--surface2); border-radius: 999px; height: 10px; overflow: hidden; }
  .prog-fill   { height: 100%; border-radius: 999px; background: linear-gradient(90deg, var(--accent), var(--accent2)); transition: width 0.5s ease; }
  .prog-pct    { text-align: center; font-family: 'DM Mono', monospace; font-size: 0.75rem; color: var(--accent2); margin-top: 5px; }

  /* â”€â”€ API note â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .api-note {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 10px; padding: 14px 18px;
    font-size: 0.73rem; color: var(--muted); text-align: center; margin-bottom: 24px;
  }
  .api-note a { color: var(--accent2); text-decoration: none; }
  .api-note a:hover { text-decoration: underline; }

  /* â”€â”€ Host guide â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .guide-box {
    background: var(--surface); border: 1px solid rgba(245,200,66,0.25);
    border-radius: 14px; padding: 22px; margin-bottom: 28px;
  }
  .guide-box h3 { font-family: 'DM Serif Display', serif; font-size: 1rem; color: var(--gold); margin-bottom: 14px; }
  .step { display: flex; gap: 14px; margin-bottom: 12px; align-items: flex-start; }
  .step .num {
    width: 26px; height: 26px; border-radius: 50%; flex-shrink: 0;
    background: rgba(245,200,66,0.12); border: 1px solid rgba(245,200,66,0.3);
    color: var(--gold); font-family: 'DM Mono', monospace; font-size: 0.75rem;
    display: flex; align-items: center; justify-content: center; font-weight: 500;
  }
  .step .txt { font-size: 0.82rem; color: var(--text); line-height: 1.5; }
  .step .txt code {
    background: var(--surface2); border: 1px solid var(--border);
    padding: 1px 6px; border-radius: 4px; font-family: 'DM Mono', monospace;
    font-size: 0.78rem; color: var(--accent2);
  }

  @media (max-width: 520px) {
    .hdr h1 { font-size: 1.5rem; }
    .fnums  { gap: 12px; }
    .nav-badge { min-width: unset; }
  }
</style>
</head>
<body>
<div class="wrap">

  <!-- Header -->
  <div class="hdr">
    <div class="hdr-top">
      <div>
        <h1>My Portfolio<br><span>Live NAV Tracker</span></h1>
        <p>Furniture &amp; Interior Goal Â· December 2027</p>
      </div>
      <button class="live-btn" onclick="fetchAll()">
        <div class="dot"></div> LIVE Â· mfapi.in
      </button>
    </div>
    <div class="goal-bar">
      <div class="goal-item">
        <div class="gl">Total Invested</div>
        <div class="gv blue">â‚¹2,14,989</div>
      </div>
      <div class="goal-item">
        <div class="gl">Monthly SIP</div>
        <div class="gv gold">â‚¹70,000</div>
      </div>
      <div class="goal-item">
        <div class="gl">Time Remaining</div>
        <div class="gv green" id="months-left">â€” months</div>
      </div>
      <div class="goal-item">
        <div class="gl">Last NAV Fetch</div>
        <div class="gv" id="last-fetch" style="color:var(--muted)">â€”</div>
      </div>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="cards">
    <div class="card">
      <div class="cl">Invested</div>
      <div class="cv b">â‚¹2,14,989</div>
      <div class="cs">3 active funds</div>
    </div>
    <div class="card">
      <div class="cl">Current Value</div>
      <div class="cv" id="kpi-value">â‚¹2,15,350</div>
      <div class="cs">Live estimate</div>
    </div>
    <div class="card">
      <div class="cl">Gain / Loss</div>
      <div class="cv g" id="kpi-gain">+â‚¹361</div>
      <div class="cs g" id="kpi-pct">+1.9%</div>
    </div>
    <div class="card">
      <div class="cl">Monthly SIP</div>
      <div class="cv go">â‚¹70,000</div>
      <div class="cs">3 SIPs active</div>
    </div>
  </div>

  <!-- Fund Cards -->
  <div class="sec">Your Holdings</div>

  <!-- Kotak -->
  <div class="fund">
    <div class="fund-top">
      <div class="fund-left">
        <div class="ficon" style="background:linear-gradient(135deg,#1a56db,#3d8bff)">KA</div>
        <div>
          <div class="fname">Kotak Arbitrage Growth Direct Plan</div>
          <div class="ftype">Arbitrage Â· Low Risk Â· ISIN: INF174K01LC6</div>
          <div class="sip-tag">SIP â‚¹35,000 / month</div>
        </div>
      </div>
      <div class="nav-badge loading" id="nav-0">Fetching NAVâ€¦</div>
    </div>
    <div class="fnums">
      <div class="ni"><div class="nl">Invested</div><div class="nv">â‚¹1,09,995</div></div>
      <div class="ni"><div class="nl">Value</div><div class="nv" id="val-0">â‚¹1,10,664</div></div>
      <div class="ni"><div class="nl">Return</div><div class="nv g">+â‚¹669</div></div>
      <div class="ni"><div class="nl">Return %</div><div class="nv g">+6.91%</div></div>
      <div class="ni"><div class="nl">Portfolio</div><div class="nv">51.4%</div></div>
    </div>
    <div class="bar-track"><div class="bar-fill" style="width:51.4%;background:linear-gradient(90deg,#1a56db,#3d8bff)"></div></div>
  </div>

  <!-- ICICI Multi Asset -->
  <div class="fund">
    <div class="fund-top">
      <div class="fund-left">
        <div class="ficon" style="background:linear-gradient(135deg,#f59e0b,#fbbf24)">MA</div>
        <div>
          <div class="fname">ICICI Prudential Multi Asset Growth Direct</div>
          <div class="ftype">Multi Asset Â· Moderate Risk Â· ISIN: INF109K01Z28</div>
          <div class="sip-tag">SIP â‚¹25,000 / month</div>
        </div>
      </div>
      <div class="nav-badge loading" id="nav-1">Fetching NAVâ€¦</div>
    </div>
    <div class="fnums">
      <div class="ni"><div class="nl">Invested</div><div class="nv">â‚¹49,998</div></div>
      <div class="ni"><div class="nl">Value</div><div class="nv" id="val-1">â‚¹49,972</div></div>
      <div class="ni"><div class="nl">Return</div><div class="nv r">âˆ’â‚¹26</div></div>
      <div class="ni"><div class="nl">Return %</div><div class="nv r">âˆ’0.69%</div></div>
      <div class="ni"><div class="nl">Portfolio</div><div class="nv">23.2%</div></div>
    </div>
    <div class="bar-track"><div class="bar-fill" style="width:23.2%;background:linear-gradient(90deg,#f59e0b,#fbbf24)"></div></div>
  </div>

  <!-- ICICI Equity Saving -->
  <div class="fund">
    <div class="fund-top">
      <div class="fund-left">
        <div class="ficon" style="background:linear-gradient(135deg,#0e9f6e,#34d399)">ES</div>
        <div>
          <div class="fname">ICICI Prudential Equity Saving Cumulative</div>
          <div class="ftype">Equity Savings Â· Low-Moderate Risk Â· ISIN: INF109K01Z10</div>
          <div class="sip-tag">SIP â‚¹10,000 / month</div>
        </div>
      </div>
      <div class="nav-badge loading" id="nav-2">Fetching NAVâ€¦</div>
    </div>
    <div class="fnums">
      <div class="ni"><div class="nl">Invested</div><div class="nv">â‚¹54,997</div></div>
      <div class="ni"><div class="nl">Value</div><div class="nv" id="val-2">â‚¹54,714</div></div>
      <div class="ni"><div class="nl">Return</div><div class="nv r">âˆ’â‚¹283</div></div>
      <div class="ni"><div class="nl">Return %</div><div class="nv r">âˆ’5.02%</div></div>
      <div class="ni"><div class="nl">Portfolio</div><div class="nv">25.4%</div></div>
    </div>
    <div class="bar-track"><div class="bar-fill" style="width:25.4%;background:linear-gradient(90deg,#0e9f6e,#34d399)"></div></div>
  </div>

  <div class="status" id="status-msg">Connecting to mfapi.inâ€¦</div>
  <button class="refresh-btn" onclick="fetchAll()">âŸ³ &nbsp;Refresh Live NAV</button>

  <!-- Projection -->
  <div class="sec">Dec 2027 Projection</div>
  <div class="proj-box">
    <h3>Corpus Estimator</h3>
    <div class="slider-row">
      <label>Expected Annual Return:</label>
      <input type="range" id="rate" min="6" max="15" value="8" step="0.5" oninput="calcProj()">
      <span id="rate-val">8%</span>
    </div>
    <div class="proj-grid">
      <div class="pi"><div class="pl">Current Corpus</div><div class="pv">â‚¹2.15 L</div></div>
      <div class="pi"><div class="pl">SIP Ã— 24 mo</div><div class="pv">â‚¹16.80 L</div></div>
      <div class="pi"><div class="pl">Growth Earned</div><div class="pv" id="p-growth">â€”</div></div>
      <div class="pi hi"><div class="pl">ðŸŽ¯ Total by Dec 2027</div><div class="pv" id="p-total">â€”</div></div>
    </div>
    <div class="prog-wrap">
      <div class="prog-labels"><span>Now: â‚¹2.15L</span><span>Goal: â‚¹20L</span></div>
      <div class="prog-track"><div class="prog-fill" id="prog" style="width:0%"></div></div>
      <div class="prog-pct" id="prog-pct">â€”</div>
    </div>
  </div>

  <!-- GitHub Pages Hosting Guide -->
  <div class="sec">How to Host This Online (Free)</div>
  <div class="guide-box">
    <h3>ðŸš€ GitHub Pages â€” Free Hosting in 5 Minutes</h3>

    <div class="step">
      <div class="num">1</div>
      <div class="txt">Go to <a href="https://github.com" target="_blank" style="color:var(--accent2)">github.com</a> â†’ Sign up free (if you don't have account)</div>
    </div>
    <div class="step">
      <div class="num">2</div>
      <div class="txt">Click <strong>+ New repository</strong> â†’ name it <code>my-portfolio</code> â†’ set to <strong>Public</strong> â†’ click <strong>Create repository</strong></div>
    </div>
    <div class="step">
      <div class="num">3</div>
      <div class="txt">Click <strong>uploading an existing file</strong> â†’ drag and drop this <code>index.html</code> file â†’ click <strong>Commit changes</strong></div>
    </div>
    <div class="step">
      <div class="num">4</div>
      <div class="txt">Go to <strong>Settings</strong> tab â†’ scroll to <strong>Pages</strong> â†’ Source: <code>Deploy from branch</code> â†’ Branch: <code>main</code> â†’ click <strong>Save</strong></div>
    </div>
    <div class="step">
      <div class="num">5</div>
      <div class="txt">Wait ~60 seconds â†’ your dashboard is live at:<br><code>https://YOUR-USERNAME.github.io/my-portfolio/</code></div>
    </div>
    <div class="step">
      <div class="num">âœ“</div>
      <div class="txt" style="color:var(--accent)">Once hosted, the LIVE NAV button will fetch real-time prices automatically every time you open it â€” on any device, including mobile!</div>
    </div>
  </div>

  <div class="api-note">
    Live NAV data via <a href="https://mfapi.in" target="_blank">mfapi.in</a> Â· Free &amp; open Indian MF API Â· Data sourced from AMFI India Â· No API key required
  </div>

</div>

<script>
  // â”€â”€ Countdown â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  (function(){
    const target = new Date(2027,11,6);
    const now    = new Date();
    const m = (target.getFullYear()-now.getFullYear())*12 + (target.getMonth()-now.getMonth());
    document.getElementById('months-left').textContent = m + ' months';
  })();

  // â”€â”€ Fund config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const FUNDS = [
    { code:'119551', invested:109995, avgNav:41.4519,  units:2655.82 },
    { code:'120586', invested:49998,  avgNav:909.2769, units:54.99   },
    { code:'120584', invested:54997,  avgNav:25.0791,  units:2192.36 },
  ];

  // We try mfapi.in directly first (works when hosted online)
  // If CORS blocks it, we fall back to a public CORS proxy
  const PROXIES = [
    url => url,                                              // Direct (works on GitHub Pages)
    url => `https://corsproxy.io/?${encodeURIComponent(url)}`, // Proxy fallback
  ];

  async function tryFetch(url) {
    for (const proxy of PROXIES) {
      try {
        const res = await fetch(proxy(url), { signal: AbortSignal.timeout(8000) });
        if (res.ok) return await res.json();
      } catch(e) { /* try next proxy */ }
    }
    return null;
  }

  async function fetchFund(idx) {
    const f   = FUNDS[idx];
    const el  = document.getElementById(`nav-${idx}`);
    const vel = document.getElementById(`val-${idx}`);
    el.className = 'nav-badge loading';
    el.textContent = 'Fetching NAVâ€¦';

    const data = await tryFetch(`https://api.mfapi.in/mf/${f.code}/latest`);

    if (data && data.status === 'SUCCESS' && data.data?.[0]) {
      const nav  = parseFloat(data.data[0].nav);
      const date = data.data[0].date;
      const val  = f.units * nav;
      const gain = val - f.invested;

      el.className = 'nav-badge';
      el.textContent = `NAV â‚¹${nav.toFixed(4)} Â· ${date}`;

      if (vel) vel.textContent = 'â‚¹' + Math.round(val).toLocaleString('en-IN');
      return { val, gain, ok: true };
    } else {
      el.className = 'nav-badge error';
      el.textContent = 'NAV unavailable';
      return { val: 0, gain: 0, ok: false };
    }
  }

  async function fetchAll() {
    const msg = document.getElementById('status-msg');
    msg.className = 'status'; msg.textContent = 'Fetching live NAV dataâ€¦';

    const results = await Promise.all(FUNDS.map((_, i) => fetchFund(i)));
    const ok = results.filter(r => r.ok).length;

    if (ok === 3) {
      const totalVal  = results.reduce((s,r) => s + r.val, 0);
      const totalGain = results.reduce((s,r) => s + r.gain, 0);
      const pct       = totalGain / 214989 * 100;

      document.getElementById('kpi-value').textContent = 'â‚¹' + Math.round(totalVal).toLocaleString('en-IN');
      document.getElementById('kpi-gain').textContent  = (totalGain >= 0 ? '+' : '') + 'â‚¹' + Math.round(Math.abs(totalGain)).toLocaleString('en-IN');
      document.getElementById('kpi-pct').textContent   = (pct >= 0 ? '+' : '') + pct.toFixed(2) + '%';
      document.getElementById('kpi-gain').className    = 'cv ' + (totalGain >= 0 ? 'g' : 'r');
      document.getElementById('kpi-pct').className     = 'cs ' + (pct >= 0 ? 'g' : 'r');

      msg.className = 'status ok';
      msg.textContent = `âœ“ All NAVs updated Â· ${new Date().toLocaleTimeString('en-IN')}`;
      document.getElementById('last-fetch').textContent = new Date().toLocaleTimeString('en-IN');
    } else if (ok > 0) {
      msg.className = 'status info';
      msg.textContent = `âš  ${ok}/3 NAVs loaded Â· some funds unavailable`;
    } else {
      msg.className = 'status err';
      msg.textContent = 'âš  Live fetch blocked Â· Host on GitHub Pages for full API access (see guide below)';
    }
  }

  // â”€â”€ Projection calculator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function fmt(v) {
    return v >= 1e5 ? 'â‚¹' + (v/1e5).toFixed(2) + ' L' : 'â‚¹' + Math.round(v).toLocaleString('en-IN');
  }

  function calcProj() {
    const rate  = parseFloat(document.getElementById('rate').value);
    document.getElementById('rate-val').textContent = rate + '%';
    const r = rate / 100 / 12, n = 24, corpus = 215350, sip = 70000, GOAL = 2e6;
    const fvC   = corpus * Math.pow(1+r, n);
    const fvS   = sip * ((Math.pow(1+r,n)-1)/r) * (1+r);
    const total = fvC + fvS;
    const growth= total - corpus - sip*n;
    document.getElementById('p-growth').textContent = fmt(growth);
    document.getElementById('p-total').textContent  = fmt(total);
    const pct = Math.min(total/GOAL*100, 100);
    document.getElementById('prog').style.width  = pct + '%';
    document.getElementById('prog-pct').textContent = pct.toFixed(1) + '% of â‚¹20L goal';
  }

  calcProj();
  fetchAll();
</script>
</body>
</html>
